"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.checksum = void 0;
const snaps_1 = require("../../snaps.cjs");
const types_1 = require("../../types.cjs");
/**
 * Check if the checksum in manifest matches computed value.
 */
exports.checksum = {
    severity: 'error',
    async semanticCheck(files, context) {
        const fetchedFiles = files;
        const gotChecksum = files.manifest.result.source.shasum;
        const expectedChecksum = await (0, snaps_1.getSnapChecksum)(fetchedFiles);
        if (gotChecksum !== expectedChecksum) {
            context.report(`"${types_1.NpmSnapFileNames.Manifest}" "shasum" field does not match computed shasum. Got "${gotChecksum}", expected "${expectedChecksum}".`, async ({ manifest }) => {
                manifest.source.shasum = expectedChecksum;
                return { manifest };
            });
        }
    },
};
//# sourceMappingURL=checksum.cjs.map